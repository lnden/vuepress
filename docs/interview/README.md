# 前端优化

## 浏览器的组成部分

- 用户界面：
包括地址栏、后退/前进按钮、书签目录

- 浏览器引擎：
用来查询及操作渲染引擎的接口

- 渲染引擎：
用来显示请求的内容，请求内容为html，它负责解析html及css，解析后展示结果

- 网络：
用来完成网络调用，HTTP请求，具有平台无关的接口，可以在不同平台工作

- UI后端：
用来绘制类似组合选择框及对话框等基本组件

- JS解释器：
用来解析执行JS代码

- 数据存储：
属于持久层，浏览器需要在硬盘中保存类似cookie的各种数据

<img :src="$withBase('/browser.png')" alt="browser" width="400">

## 渲染引擎的基本流程

- Chrome的Webkit主流程
<img :src="$withBase('/webkit.png')" alt="webkit" width="600">

```
元素结构 → 元素解析器 → DOM树

                           →   附着合成     →    渲染树(Layout)    →    绘制    →     显示

样式表 → 样式解析器 → 样式规则树
```

- Mozilla的Geoko主流程
<img :src="$withBase('/mozilla.jpg')" alt="mozilla" width="600">

## 重绘和回流的区别

- replaint：(重绘)屏幕的一部分重画，不影响整体布局，比如某个CSS的背景色变了，但元素的几何尺寸和位置不变。
- reflow：(回流)意味着元件的几何尺寸变了，我们需要重新验证并计算渲染树。是渲染树的一部分或全部发生了变化。这就是Reflow，或是Layout。

## 前端性能优化

1.减少http的请求次数

2.减少DNS的查询次数

3.尽量少用iframe

4.减少DOM的操作

5.使用CDN网络分发

6.ajax缓存机制

7.css放在头部HTML规范清楚指出样式表要放包含在页面的`<head />`区域内；

8.把JS放到底部HTTP/1.1 规范建议，浏览器每个主机名的并行下载内容不超过两个，而问题在于脚本阻止了页面的平行下载，即便是主机名不相同

9.将CSS和JS放到外部文件中

10.用`<link>`代替@import

11.优化CSS Spirite

12.小图片使用base64

13.图片使用懒加载

14.合并打包压缩

15.将资源放到不同的域下：浏览器同时从一个域下载资源的数目有限，增加域可以提高并行下载

16.减少iframe数量

## 渐进增强、优雅降级

开始针对低版本浏览器进行构建，完成基本的功能，然后针对高版本浏览器进行效果、交互得到更好的体验

开始就构建站点的完整功能，然后针对浏览器测试和修复。比如一开始使用 CSS3 的特性构建了一个应用，然后逐步针对各大浏览器进行 hack 使其可以在低版本浏览器上正常浏览。


